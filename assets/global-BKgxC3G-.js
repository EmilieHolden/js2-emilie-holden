(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();function g(s){let t=!0;return s.querySelectorAll(".input-error").forEach(e=>e.classList.remove("input-error")),s.querySelectorAll(".error-text").forEach(e=>e.remove()),s.querySelectorAll("input, textarea, select").forEach(e=>{if(e.id==="email"){const o=/^[^@]+@stud\.noroff\.no$/;if(e.value&&!o.test(e.value)){t=!1,e.classList.add("input-error");const n=document.createElement("p");n.classList.add("error-text"),n.textContent="Email must be a valid stud.noroff.no address.",e.insertAdjacentElement("beforebegin",n);return}}if(!e.checkValidity()){t=!1,e.classList.add("input-error");const o=document.createElement("p");o.classList.add("error-text"),e.id==="password"&&e.value.length<8?o.textContent="Password must be at least 8 characters.":o.textContent=e.validationMessage,e.insertAdjacentElement("beforebegin",o)}}),t}async function f(s){const t="https://v2.api.noroff.dev/auth/login";try{const e=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),o=await e.json();if(!e.ok)throw new Error(o.errors?.[0]?.message||"An unknown error occurred");return o}catch(e){throw e}}const u=document.getElementById("login-main-container");function p(){u.innerHTML=`
        <h2>Login</h2>
        <form id="login-form" novalidate>
        <div class="form-spacing"><label for="email">Email</label>
            <input type="email" id="email" name="email" required /></div>
        <div class="form-spacing"><label for="password">Password</label>
            <input type="password" id="password" name="password" minlength="8" required /></div>
            <button class="primary-btn form-spacing" type="submit" id="login-btn">Login</button>
        </form>
        <p id="login-message"></p>
        <a class="link" href="/register.html">Register account</a>
    `;const s=document.getElementById("login-form"),t=document.getElementById("login-message");s&&s.addEventListener("submit",async e=>{if(e.preventDefault(),!g(s))return;const o={email:document.getElementById("email").value.trim(),password:document.getElementById("password").value};let n=!1;try{n=!0,t.textContent="Logging in...";const r=await f(o);localStorage.setItem("token",r.data.accessToken),localStorage.setItem("user",JSON.stringify(r.data)),t.textContent="Login successful!",t.classList.add("success-text"),setTimeout(()=>{y(),window.location.href="/src/pages/feed.html"},1e3)}catch(r){t.textContent=`Login failed. ${r.message}`,t.classList.add("error-text")}})}function y(){u.innerHTML=`
        <h1>You are logged in</h1>
        <button class="btn-main" id="logout-btn">Log out</button>
    `;const s=document.getElementById("logout-btn");s&&s.addEventListener("click",()=>{v(),p()})}function v(){localStorage.removeItem("token"),localStorage.removeItem("user")}u&&(localStorage.getItem("token")?y():p());const w="0687c3e4-578f-46b6-8524-17fe91d9bee6",L=localStorage.getItem("token"),b={headers:{Authorization:`Bearer ${L}`,"X-Noroff-API-Key":w}};async function E(s=1,t=10){const e=`https://v2.api.noroff.dev/social/posts?page=${s}&limit=${t}`;try{const o=await fetch(e,b);if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);return await o.json()}catch(o){throw o}}const a=document.getElementById("load-more-btn");let m=1,c=!1;async function h(s=1){const t=document.querySelector("#container");if(t&&!c){c=!0,a.textContent="Loading...",a.disabled=!0;try{s===1&&(t.innerHTML="<p>Loading...</p>");const e=await E(s,10),o=e.data,n=e.meta;s===1&&(t.innerHTML=""),o.forEach(r=>{t.innerHTML+=`
            <div class="card">
                <div class="post-image-container">
                    ${r.media?.url?`<img class="card-image" src="${r.media.url}" alt="${r.media.alt||"Post image"}">`:""}
                </div>
                <div class="card-content">
                    <p class="post-user">${r.author?.name||"Unknown author"}</p>
                     <p class="post-date">${new Date(r.created).toLocaleDateString()}</p>
                     <div class="post-body-container">
                     <p class="post-body">${r.body}</p>
                    </div>
                </div>
            </div>
            `}),n.isLastPage?a.style.display="none":(m=n.nextPage,a.textContent="Load More",a.disabled=!1)}catch(e){t.textContent="Failed to load posts",console.error(e)}finally{c=!1}a.addEventListener("click",()=>{c||h(m)})}}h();async function I(s){const t="https://v2.api.noroff.dev/auth/register";try{const e=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),o=await e.json();if(!e.ok)throw new Error(o.errors?.[0]?.message||"An unknown error occurred");return o}catch(e){throw e}}const d=document.getElementById("register-form"),i=document.getElementById("register-message");d&&d.addEventListener("submit",async s=>{if(s.preventDefault(),!g(d))return;const t={name:document.getElementById("username").value.trim(),email:document.getElementById("email").value.trim(),password:document.getElementById("password").value},e=document.getElementById("bio").value.trim(),o=document.getElementById("avatarImgUrl").value.trim();e&&(t.bio=e),o&&(t.avatar={url:o});let n=!1;try{n=!0,i.textContent="Registrating account...",i.classList.remove("error-text","success-text"),await I(t);const r=await f({email:t.email,password:t.password});localStorage.setItem("token",r.data.accessToken),localStorage.setItem("user",JSON.stringify(r.data)),i.textContent="Registration successful, you are now logged in to your new account",i.classList.add("success-text"),setTimeout(()=>{window.location.href="../../index.html"},1e3)}catch(r){i.textContent=`Registration failed. ${r.message}`,i.classList.add("error-text")}});
